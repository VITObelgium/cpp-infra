CMAKE_POLICY(SET CMP0020 NEW)
SET(CMAKE_AUTOMOC ON)
FIND_PACKAGE(Qt5Gui)
FIND_PACKAGE(Qt5Widgets)
FIND_PACKAGE(Qt5PrintSupport)

FIND_LIBRARY(QT_PLATFORMSUPPORT_LIBRARY NAMES Qt5PlatformSupport)
FIND_LIBRARY(QT_PLATFORMSUPPORT_LIBRARY_DEBUG NAMES Qt5PlatformSupportd)

FIND_LIBRARY(QT_HARFBUZZ_LIBRARY NAMES qtharfbuzzng)
FIND_LIBRARY(QT_HARFBUZZ_LIBRARY_DEBUG NAMES qtharfbuzzngd)

FIND_LIBRARY(QT_FREETYPE_LIBRARY NAMES qtfreetype)
FIND_LIBRARY(QT_FREETYPE_LIBRARY_DEBUG NAMES qtfreetyped)

FIND_LIBRARY(QT_PCRE_LIBRARY NAMES qtpcre)
FIND_LIBRARY(QT_PCRE_LIBRARY_DEBUG NAMES qtpcred)

IF (WIN32)
    FIND_LIBRARY(QT_MAIN_LIBRARY NAMES qtmain)
ELSE ()
    FIND_LIBRARY(PNG_LIBRARY NAMES qtpng)
ENDIF ()

ADD_EXECUTABLE(opaqui
    main.cpp
    mainwindow.h mainwindow.cpp
)

IF (WIN32)
    TARGET_LINK_LIBRARIES(opaqui Qt5::QWindowsIntegrationPlugin imm32 winmm)
ELSEIF (APPLE)
    FIND_LIBRARY(OPENGL_LIBRARY OpenGL)
    FIND_LIBRARY(CUPS_LIBRARY cups)
    TARGET_LINK_LIBRARIES(opaqui ${OPENGL_LIBRARY})

    TARGET_LINK_LIBRARIES(opaqui
        Qt5::QCocoaIntegrationPlugin
        "-framework CoreFoundation"
        "-framework CoreGraphics"
        "-framework CoreText"
        "-framework Carbon"
        "-framework AppKit"
        "-framework IOKit"
        ${CUPS_LIBRARY}
    )
ENDIF ()

TARGET_LINK_LIBRARIES(opaqui opaqcore Qt5::Gui Qt5::Widgets Qt5::PrintSupport ${EXTRA_LIBS} ${QT_MAIN_LIBRARY})

IF (WIN32)
    TARGET_LINK_LIBRARIES(opaqui
        debug ${QT_HARFBUZZ_LIBRARY_DEBUG} optimized ${QT_HARFBUZZ_LIBRARY}
        debug ${QT_PLATFORMSUPPORT_LIBRARY_DEBUG} optimized ${QT_PLATFORMSUPPORT_LIBRARY}
        debug ${QT_FREETYPE_LIBRARY_DEBUG} optimized ${QT_FREETYPE_LIBRARY}
        debug ${QT_PCRE_LIBRARY_DEBUG} optimized ${QT_PCRE_LIBRARY})
ELSE ()
    TARGET_LINK_LIBRARIES(opaqui ${QT_HARFBUZZ_LIBRARY} ${QT_PCRE_LIBRARY} ${QT_PLATFORMSUPPORT_LIBRARY} ${QT_FREETYPE_LIBRARY} ${PNG_LIBRARY})
ENDIF ()